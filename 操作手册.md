# Vue加分名单生成系统 - 操作手册

## 目录

1. [系统概述](#系统概述)
2. [前端操作指南](#前端操作指南)
3. [Python脚本使用指南](#python脚本使用指南)
4. [常见问题排查](#常见问题排查)
5. [数据格式说明](#数据格式说明)

## 系统概述

Vue加分名单生成系统用于工学院学生加分统计，支持从Excel数据源自动生成标准格式的加分名单。系统提供两种使用方式：

1. **前端操作**：适合中小数据量（<3000行），可视化操作，界面友好
2. **Python脚本**：适合大数据量（≥3000行），命令行操作，处理速度快

## 前端操作指南

### 步骤1：上传文件

1. 打开系统首页
2. 将Excel文件拖拽到上传区域，或点击上传按钮选择文件
3. 支持同时上传最多3个文件
4. 文件要求：
   - 格式：`.xlsx`
   - 大小：≤10MB
   - 必须包含"数据源"工作表
   - 必须包含15个核心字段

5. 点击"开始解析"按钮

**注意事项**：
- 如果文件格式不正确，系统会提示"请上传标准Excel文件（.xlsx）"
- 如果缺少"数据源"工作表，系统会提示"请上传包含'数据源'工作表的标准文件"
- 如果缺少必需字段，系统会明确提示缺少哪些列

### 步骤2：查看解析结果

解析完成后，系统会显示：

- **数据统计卡片**：
  - 总数据量
  - 有效数据量
  - 涉及班级数
  - 活动类型数

- **数据预览表格**：显示解析后的核心字段

### 步骤3：考勤验证

1. 在"考勤验证"区域配置考勤关键词
   - 默认关键词：已考勤、到场、参与
   - 可自定义，用逗号分隔

2. 点击"验证考勤"按钮

3. 系统自动区分：
   - **已考勤人员**：可纳入加分名单
   - **未考勤人员**：纳入黑名单

4. 查看统计：
   - 已考勤人数
   - 未考勤人数

5. （可选）导出黑名单：
   - 点击"导出黑名单"按钮
   - 文件自动命名为：`20XX-20XX学年第X学期未考勤人员黑名单.xlsx`

### 步骤4：数据筛选

1. 进入"数据筛选"页面

2. 配置筛选条件：
   - **学年学期**：下拉选择
   - **活动类型**：多选（活动、讲座、比赛）
   - **活动名称**：输入关键词，支持模糊搜索
   - **加分类型**：单选（学业分、品德分）
   - **加分分数范围**：输入最小值和最大值
   - **行政班级**：多选，支持搜索
   - **其他选项**：
     - 是否包含其他学院人员
     - 是否按班级排序

3. 点击"应用筛选"按钮

4. 查看筛选结果：
   - 显示筛选后的数据量
   - 预览前20条数据

5. （可选）点击"重置筛选"恢复所有数据

### 步骤5：导出加分名单

1. 进入"导出"页面

2. 选择模板类型：
   - **活动/讲座类**：双列布局（序号、班级、姓名）
   - **比赛类**：单列布局（序号、班级、姓名、奖项、加分数）

3. 填写导出信息：
   - **活动名称**：输入活动名称
   - **学年学期**：选择学年学期
   - **加分类型**：选择学业分或品德分
   - **加分分数**：（仅活动/讲座类）输入分数

4. 预览导出数据：
   - 查看将要导出的数据
   - 确认数据正确性

5. 点击"导出加分名单"按钮

6. 文件自动下载，命名格式：
   - `202X-202X学年第X学期工学院XXX活动/比赛加分名单.xlsx`

## Python脚本使用指南

### 环境准备

1. 安装Python 3.8或更高版本
2. 安装依赖库：
   ```bash
   cd scripts
   pip install -r requirements.txt
   ```

### 脚本1：数据解析与考勤验证

**功能**：批量解析Excel文件，验证考勤，生成黑名单

**命令格式**：
```bash
python data_parser.py --input <输入路径> [--config <配置文件>] [--output <输出目录>]
```

**参数说明**：
- `--input`：必需，输入文件路径或文件夹路径
- `--config`：可选，配置文件路径（JSON格式）
- `--output`：可选，输出目录（默认：./output）

**使用示例**：

单个文件：
```bash
python data_parser.py --input data.xlsx --output ./output
```

批量处理文件夹：
```bash
python data_parser.py --input ./data_folder --output ./output
```

使用自定义配置：
```bash
python data_parser.py --input data.xlsx --config my_config.json --output ./output
```

**输出文件**：
- `parsed_data.xlsx`：解析后的有效数据（已考勤）
- `blacklist.xlsx`：未考勤人员黑名单
- `report.txt`：统计报告

### 脚本2：数据筛选

**功能**：按条件筛选数据

**命令格式**：
```bash
python data_filter.py --input <输入文件> --config <筛选配置> [--output <输出目录>]
```

**参数说明**：
- `--input`：必需，输入文件路径（parsed_data.xlsx）
- `--config`：必需，筛选条件配置文件（JSON格式）
- `--output`：可选，输出目录（默认：./output）

**配置文件示例**（filter_config.json）：
```json
{
  "semester": "2024-2025学年第X学期",
  "activityTypes": ["活动", "讲座"],
  "activityName": "XXX活动",
  "scoreType": "学业分",
  "minScore": 1,
  "maxScore": 3,
  "classes": ["班级1", "班级2"],
  "includeOtherCollege": true,
  "sortByClass": true,
  "useRegex": false
}
```

**使用示例**：
```bash
python data_filter.py --input ./output/parsed_data.xlsx --config filter_config.json --output ./output
```

**输出文件**：
- `filtered_data.xlsx`：筛选后的候选加分名单
- `filter_log.txt`：筛选日志

### 脚本3：加分名单生成

**功能**：按模板生成标准格式的加分名单

**命令格式**：

活动/讲座类：
```bash
python list_generator.py --input <输入文件> --template activity --semester <学年学期> --activity <活动名称> --scoreType <加分类型> --score <分数> [--output <输出目录>]
```

比赛类：
```bash
python list_generator.py --input <输入文件> --template competition --semester <学年学期> --activity <活动名称> --scoreType <加分类型> [--output <输出目录>]
```

**参数说明**：
- `--input`：必需，输入文件路径（filtered_data.xlsx）
- `--template`：必需，模板类型（activity 或 competition）
- `--semester`：必需，学年学期
- `--activity`：必需，活动名称
- `--scoreType`：必需，加分类型（学业分 或 品德分）
- `--score`：活动/讲座类必需，加分分数
- `--output`：可选，输出目录（默认：./output）

**使用示例**：

活动类：
```bash
python list_generator.py --input ./output/filtered_data.xlsx --template activity --semester "2024-2025学年第X学期" --activity "XXX活动" --scoreType "学业分" --score 1 --output ./output
```

比赛类：
```bash
python list_generator.py --input ./output/filtered_data.xlsx --template competition --semester "2024-2025学年第X学期" --activity "XXX比赛" --scoreType "学业分" --output ./output
```

**输出文件**：
- 标准格式的加分名单Excel文件

### 完整工作流程示例

```bash
# 1. 解析数据并验证考勤
python data_parser.py --input ./data --output ./output

# 2. 筛选数据
python data_filter.py --input ./output/parsed_data.xlsx --config filter_config.json --output ./output

# 3. 生成加分名单（活动类）
python list_generator.py --input ./output/filtered_data.xlsx --template activity --semester "2024-2025学年第X学期" --activity "XXX活动" --scoreType "学业分" --score 1 --output ./output
```

## 常见问题排查

### 问题1：文件上传失败

**症状**：点击上传后提示错误

**排查步骤**：
1. 检查文件格式是否为 `.xlsx`（不是 `.xls`）
2. 检查文件大小是否超过10MB
3. 检查文件是否损坏（尝试用Excel打开）
4. 检查浏览器控制台是否有错误信息

**解决方案**：
- 将 `.xls` 文件另存为 `.xlsx` 格式
- 压缩文件或分批上传
- 修复损坏的Excel文件

### 问题2：字段缺失错误

**症状**：解析时提示"缺少XX列"

**排查步骤**：
1. 检查数据源工作表名称是否为"数据源"（区分大小写）
2. 检查字段名称是否完全匹配（注意空格、标点）
3. 检查第一行是否为字段名

**解决方案**：
- 重命名工作表为"数据源"
- 检查并修正字段名称
- 确保第一行为字段名，第二行开始为数据

### 问题3：考勤验证结果不正确

**症状**：已考勤/未考勤人数不符合预期

**排查步骤**：
1. 检查"备注"列是否包含考勤信息
2. 检查考勤关键词配置是否正确
3. 查看数据预览，检查备注内容

**解决方案**：
- 调整考勤关键词（如：已考勤、到场、参与）
- 检查数据源中备注列的格式
- 手动调整考勤状态（如需要）

### 问题4：导出文件格式不正确

**症状**：导出的Excel文件格式错乱

**排查步骤**：
1. 检查使用的Excel软件版本（建议Excel 2016+或WPS）
2. 检查模板类型是否选择正确
3. 检查导出数据是否为空

**解决方案**：
- 使用Microsoft Excel 2016+或WPS打开
- 重新选择正确的模板类型
- 确保筛选后有数据可导出

### 问题5：Python脚本运行失败

**症状**：执行脚本时提示错误

**排查步骤**：
1. 检查Python版本：`python --version`（应为3.8+）
2. 检查依赖是否安装：`pip list | grep pandas`
3. 检查输入文件路径是否正确
4. 检查配置文件格式是否正确（JSON格式）

**解决方案**：
- 升级Python到3.8+
- 安装依赖：`pip install -r requirements.txt`
- 使用绝对路径或检查相对路径
- 验证JSON格式（可使用在线JSON验证工具）

### 问题6：大数据量处理慢

**症状**：前端处理3000+行数据时很慢

**解决方案**：
- 使用Python脚本处理大数据量
- 分批处理数据（每次处理部分数据）
- 优化数据源（去除不必要的数据）

## 数据格式说明

### Excel文件结构

```
工作表名称：数据源（必须）

第一行（字段名）：
序号 | 学年学期 | 是否为工学院举办 | 行政班级 | 学号 | 姓名 | 活动类型 | 活动名称 | 加分类型 | 加分分数 | 奖项 | 部门 | 负责人 | 联系电话 | 备注

第二行开始（数据）：
1 | 2024-2025学年第X学期 | 是 | 计算机1班 | 2024001 | 张三 | 活动 | XXX活动 | 学业分 | 1 | - | 学习部 | 李四 | 13800138000 | 已考勤
...
```

### 字段说明

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| 序号 | 数字 | 行号 | 1 |
| 学年学期 | 文本 | 学年学期信息 | 2024-2025学年第X学期 |
| 是否为工学院举办 | 文本 | 是/否 | 是 |
| 行政班级 | 文本 | 班级名称 | 计算机1班 |
| 学号 | 文本 | 学生学号（可为空） | 2024001 |
| 姓名 | 文本 | 学生姓名（必需） | 张三 |
| 活动类型 | 文本 | 活动、讲座、比赛 | 活动 |
| 活动名称 | 文本 | 活动名称（必需） | XXX活动 |
| 加分类型 | 文本 | 学业分、品德分 | 学业分 |
| 加分分数 | 数字 | 加分分数 | 1 |
| 奖项 | 文本 | 奖项名称（比赛类） | 一等奖 |
| 部门 | 文本 | 组织部门 | 学习部 |
| 负责人 | 文本 | 活动负责人 | 李四 |
| 联系电话 | 文本 | 联系电话 | 13800138000 |
| 备注 | 文本 | 备注信息（用于考勤验证） | 已考勤 |

### 数据要求

1. **必需字段**：姓名、活动名称不能为空
2. **去重规则**：按"班级+姓名+活动名称"自动去重
3. **考勤验证**：通过"备注"列判断是否已考勤
4. **格式要求**：
   - 加分分数为数字类型
   - 学号可为空
   - 姓名和活动名称自动去除首尾空格

## 技术支持

如遇到其他问题，请：
1. 查看浏览器控制台错误信息
2. 检查数据源格式是否符合要求
3. 参考本文档的常见问题排查部分
4. 联系系统维护人员

